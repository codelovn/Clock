<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BaoHy Dashboard Ultimate</title>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@100;300;400;500;600;700&family=Inter:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            /* Palette chu·∫©n c·ªßa B·∫£o Hy */
            --midnight-blue: #050836;
            --royal-blue: #0048ba;
            --sky-blue: #00bfff;
            --pale-blue: #e0f7fa;
            --glass-surface: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-highlight: rgba(255, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --shadow-soft: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--midnight-blue);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        /* --- BACKGROUND DYNAMIC LAYER --- */
        #dynamic-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
            background: linear-gradient(120deg, #050836, #001f52, #0048ba);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        
        #weather-canvas {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* --- MAIN DASHBOARD CONTAINER --- */
        .dashboard-wrapper {
            position: relative;
            z-index: 10;
            width: 95%;
            height: 90vh;
            max-width: 1600px;
            background: rgba(5, 8, 54, 0.6);
            backdrop-filter: blur(40px) saturate(150%);
            -webkit-backdrop-filter: blur(40px) saturate(150%);
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            box-shadow: var(--shadow-soft);
            display: grid;
            grid-template-columns: 350px 1fr 300px; /* 3 C·ªôt: Tools - Main - News */
            grid-template-rows: 1fr;
            gap: 20px;
            padding: 30px;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* --- COLUMN 1: LEFT SIDEBAR (TOOLS) --- */
        .col-left {
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .widget-card {
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 20px;
            transition: transform 0.3s ease, background 0.3s;
        }
        .widget-card:hover { transform: translateY(-5px); background: var(--glass-highlight); }

        .section-title { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: var(--sky-blue); margin-bottom: 15px; font-weight: 600; }

        /* Widget Buttons Grid */
        .tools-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .tool-btn {
            background: rgba(255,255,255,0.05);
            border: none; border-radius: 16px;
            color: white; padding: 15px;
            cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px;
            font-size: 0.85rem; transition: 0.2s;
        }
        .tool-btn i { font-size: 1.5rem; color: var(--sky-blue); }
        .tool-btn:hover { background: var(--royal-blue); }
        .tool-btn:active { transform: scale(0.95); }

        /* Pomodoro Widget */
        .pomo-display { font-size: 2.5rem; font-weight: 200; text-align: center; margin: 10px 0; font-variant-numeric: tabular-nums; }
        .pomo-controls { display: flex; justify-content: center; gap: 10px; }
        .pomo-btn { padding: 5px 15px; border-radius: 20px; border: none; cursor: pointer; font-weight: 600; }
        .btn-start { background: var(--sky-blue); color: var(--midnight-blue); }
        .btn-reset { background: rgba(255,255,255,0.1); color: white; }

        /* Note Widget */
        .note-area {
            width: 100%; height: 100px; background: rgba(0,0,0,0.2);
            border: 1px solid var(--glass-border); border-radius: 15px;
            color: white; padding: 10px; resize: none; font-size: 0.9rem;
        }

        /* --- COLUMN 2: CENTER (CLOCK & WEATHER) --- */
        .col-center {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
        }

        .clock-wrapper { margin-bottom: 40px; animation: floatUp 1s ease-out; }
        .main-clock {
            font-size: 8vw; /* Responsive font size */
            font-weight: 100;
            line-height: 0.9;
            letter-spacing: -5px;
            background: linear-gradient(to bottom, #fff, #cceeff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 30px rgba(0, 72, 186, 0.3);
        }
        .date-text {
            font-size: 1.5rem;
            margin-top: 15px;
            color: var(--sky-blue);
            font-weight: 300;
            background: rgba(5, 8, 54, 0.3);
            padding: 10px 30px;
            border-radius: 50px;
            display: inline-block;
            backdrop-filter: blur(10px);
        }

        .weather-hero {
            display: flex;
            align-items: center;
            gap: 30px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02));
            padding: 30px 50px;
            border-radius: 35px;
            border: 1px solid var(--glass-border);
            min-width: 400px;
        }
        .weather-hero i { font-size: 5rem; filter: drop-shadow(0 0 15px rgba(255,255,255,0.4)); }
        .weather-info h2 { font-size: 4rem; font-weight: 200; }
        .weather-info p { font-size: 1.2rem; opacity: 0.8; }
        
        .weather-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; width: 100%; max-width: 500px; margin-top: 20px;
        }
        .stat-box {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 20px; text-align: center;
        }
        .stat-box i { color: var(--sky-blue); font-size: 1.2rem; margin-bottom: 5px; }
        .stat-value { font-size: 1.1rem; font-weight: 600; display: block;}
        .stat-label { font-size: 0.8rem; opacity: 0.6; }

        /* Smart Alert */
        .smart-alert {
            margin-top: 30px;
            background: rgba(0, 191, 255, 0.15);
            border: 1px solid rgba(0, 191, 255, 0.3);
            color: var(--pale-blue);
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            display: flex; align-items: center; gap: 15px;
            animation: pulse 3s infinite;
        }

        /* --- COLUMN 3: RIGHT (NEWS) --- */
        .col-right {
            background: rgba(0,0,0,0.2);
            border-radius: 30px;
            padding: 20px;
            display: flex; flex-direction: column;
            border: 1px solid var(--glass-border);
        }
        
        .news-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .news-toggle-btn { background: none; border: none; color: white; cursor: pointer; opacity: 0.5; transition: 0.3s; }
        .news-toggle-btn:hover { opacity: 1; color: var(--sky-blue); }

        .news-scroll { flex: 1; overflow-y: auto; padding-right: 5px; }
        .news-scroll::-webkit-scrollbar { width: 5px; }
        .news-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        
        .news-item {
            margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05);
            cursor: pointer; transition: 0.2s;
        }
        .news-item:hover { transform: translateX(5px); }
        .news-time { font-size: 0.75rem; color: var(--sky-blue); display: block; margin-bottom: 4px; }
        .news-headline { font-size: 0.95rem; line-height: 1.4; color: #ddd; }

        /* --- UTILS --- */
        .footer-credit {
            position: absolute; bottom: 20px; right: 30px;
            font-size: 0.8rem; font-style: italic; opacity: 0.4;
        }

        .fullscreen-trigger {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255,255,255,0.1); border: none; color: white;
            width: 40px; height: 40px; border-radius: 50%;
            cursor: pointer; z-index: 100;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- RESPONSIVE LOGIC (T·ª± ƒë·ªông nh·∫≠n di·ªán) --- */
        @media (max-width: 1024px) {
            .dashboard-wrapper {
                grid-template-columns: 1fr; /* Chuy·ªÉn th√†nh 1 c·ªôt d·ªçc */
                grid-template-rows: auto auto auto;
                height: 100vh;
                border-radius: 0;
                overflow-y: auto;
                padding: 20px;
            }
            .col-center { order: 1; margin-bottom: 30px; }
            .col-left { order: 2; margin-bottom: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;}
            .col-right { order: 3; height: 400px; }
            .main-clock { font-size: 5rem; }
            .weather-hero { width: 100%; min-width: unset; flex-direction: column; text-align: center; }
        }

        @media (max-width: 600px) {
            .col-left { grid-template-columns: 1fr; }
            .tools-grid { grid-template-columns: repeat(4, 1fr); }
            .tool-btn span { display: none; } /* ·∫®n ch·ªØ tr√™n mobile cho g·ªçn */
            .tool-btn i { font-size: 1.2rem; }
            .main-clock { font-size: 4rem; }
            .date-text { font-size: 1rem; padding: 8px 20px; }
        }

        /* Animations */
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes floatUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0, 191, 255, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(0, 191, 255, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 191, 255, 0); } }

    </style>
</head>
<body>

    <canvas id="weather-canvas"></canvas>
    <div id="dynamic-bg"></div>

    <div class="dashboard-wrapper" id="appFrame">
        <button class="fullscreen-trigger" onclick="toggleFullScreen()"><i class="fas fa-expand"></i></button>

        <div class="col-left">
            <div class="widget-card">
                <div class="section-title"><i class="fas fa-toolbox"></i> Ti·ªán √≠ch</div>
                <div class="tools-grid">
                    <button class="tool-btn" onclick="openCalc()"><i class="fas fa-calculator"></i><span>M√°y t√≠nh</span></button>
                    <button class="tool-btn" onclick="alert('ƒê√£ b·∫≠t b√°o th·ª©c!')"><i class="fas fa-bell"></i><span>B√°o th·ª©c</span></button>
                    <button class="tool-btn" onclick="window.open('https://calendar.google.com')"><i class="fas fa-calendar-alt"></i><span>L·ªãch</span></button>
                    <button class="tool-btn" onclick="window.open('https://youtube.com')"><i class="fab fa-youtube"></i><span>YouTube</span></button>
                </div>
            </div>

            <div class="widget-card">
                <div class="section-title"><i class="fas fa-stopwatch"></i> Pomodoro Focus</div>
                <div class="pomo-display" id="pomoTimer">25:00</div>
                <div class="pomo-controls">
                    <button class="pomo-btn btn-start" onclick="togglePomodoro()" id="pomoBtn">B·∫Øt ƒë·∫ßu</button>
                    <button class="pomo-btn btn-reset" onclick="resetPomodoro()"><i class="fas fa-redo"></i></button>
                </div>
            </div>

            <div class="widget-card">
                <div class="section-title"><i class="fas fa-sticky-note"></i> Ghi ch√∫ nhanh</div>
                <textarea class="note-area" id="quickNote" placeholder="B·∫£o Hy c·∫ßn nh·ªõ g√¨ kh√¥ng?..." oninput="saveNote()"></textarea>
            </div>
        </div>

        <div class="col-center">
            <div class="clock-wrapper">
                <div class="main-clock" id="clock">00:00:00</div>
                <div class="date-text" id="date">ƒêang t·∫£i ng√†y...</div>
            </div>

            <div class="weather-hero">
                <i class="fas fa-cloud-moon" id="mainWeatherIcon"></i>
                <div class="weather-info">
                    <h2 id="tempDisplay">--¬∞</h2>
                    <p id="weatherDesc">ƒêang c·∫≠p nh·∫≠t...</p>
                </div>
            </div>

            <div class="weather-grid">
                <div class="stat-box">
                    <i class="fas fa-tint"></i>
                    <span class="stat-value" id="humidity">--%</span>
                    <span class="stat-label">ƒê·ªô ·∫©m</span>
                </div>
                <div class="stat-box">
                    <i class="fas fa-sun"></i>
                    <span class="stat-value" id="uvIndex">--</span>
                    <span class="stat-label">UV Index</span>
                </div>
                <div class="stat-box">
                    <i class="fas fa-moon"></i>
                    <span class="stat-value" id="moonPhase">--</span>
                    <span class="stat-label">TrƒÉng</span>
                </div>
            </div>

            <div class="smart-alert" id="smartAlert">
                <i class="fas fa-robot"></i>
                <span id="alertText">Xin ch√†o B·∫£o Hy! ƒêang t·∫£i d·ªØ li·ªáu th·ªùi ti·∫øt...</span>
            </div>
        </div>

        <div class="col-right" id="newsPanel">
            <div class="news-header">
                <div class="section-title" style="margin:0"><i class="far fa-newspaper"></i> Tin VnExpress</div>
                <button class="news-toggle-btn" onclick="toggleNews()"><i class="fas fa-eye-slash"></i></button>
            </div>
            <div class="news-scroll" id="newsContainer">
                <div class="news-item"><span class="news-headline">ƒêang k·∫øt n·ªëi ƒë·∫øn VnExpress...</span></div>
            </div>
        </div>

        <div class="footer-credit">Designed by @baohyne</div>
    </div>

    <script>
        // --- 1. SYSTEM CLOCK ---
        function updateClock() {
            const now = new Date();
            // Clock
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('clock').innerText = `${h}:${m}:${s}`;
            
            // Date
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            let dateStr = now.toLocaleDateString('vi-VN', options);
            // Capitalize first letter (Th·ª© s√°u -> Th·ª© S√°u)
            dateStr = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);
            document.getElementById('date').innerText = dateStr;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // --- 2. WEATHER ENGINE (ADVANCED) ---
        // S·ª≠ d·ª•ng Open-Meteo Hourly API ƒë·ªÉ l·∫•y ch√≠nh x√°c UV t·∫°i th·ªùi ƒëi·ªÉm hi·ªán t·∫°i
        
        async function getAdvancedWeather() {
            if (!navigator.geolocation) {
                updateAlert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.", "fa-exclamation-triangle");
                return;
            }

            navigator.geolocation.getCurrentPosition(async (position) => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                
                // Fetch data: Current weather + Hourly (cho UV, Rain prob) + Daily (Sunrise/set)
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,relativehumidity_2m,weathercode,uv_index,precipitation_probability&daily=sunrise,sunset&timezone=auto`;

                try {
                    const res = await fetch(url);
                    const data = await res.json();
                    renderWeather(data);
                } catch (e) {
                    console.error(e);
                    updateAlert("Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu th·ªùi ti·∫øt.", "fa-wifi");
                }
            }, () => {
                updateAlert("B·∫£o Hy ∆°i, h√£y c·∫•p quy·ªÅn v·ªã tr√≠ ƒë·ªÉ anh b√°o th·ªùi ti·∫øt nha!", "fa-map-marker-alt");
            });
        }

        function renderWeather(data) {
            const current = data.current_weather;
            const hourIndex = new Date().getHours(); // L·∫•y index gi·ªù hi·ªán t·∫°i (0-23)
            
            // 1. Nhi·ªát ƒë·ªô & M√¥ t·∫£
            document.getElementById('tempDisplay').innerText = `${Math.round(current.temperature)}¬∞`;
            const wCode = current.weathercode;
            const wInfo = getWeatherInfo(wCode);
            document.getElementById('weatherDesc').innerText = wInfo.desc;
            document.getElementById('mainWeatherIcon').className = `fas ${wInfo.icon}`;
            
            // 2. C√°c ch·ªâ s·ªë ph·ª• (L·∫•y ch√≠nh x√°c theo gi·ªù hi·ªán t·∫°i)
            // ƒê·ªô ·∫©m
            const humidity = data.hourly.relativehumidity_2m[hourIndex];
            document.getElementById('humidity').innerText = `${humidity}%`;
            
            // UV Index (Logic quan tr·ªçng: L·∫•y theo gi·ªù th·ª±c, ƒë√™m = 0)
            let uvNow = data.hourly.uv_index[hourIndex];
            const isNight = current.is_day === 0;
            if (isNight) uvNow = 0; // Fix c·ª©ng n·∫øu API tr·∫£ v·ªÅ sai v√†o ban ƒë√™m
            document.getElementById('uvIndex').innerText = uvNow;

            // 3. Moon Phase (T√≠nh to√°n th·ªß c√¥ng)
            const moon = getMoonPhaseName(new Date());
            document.getElementById('moonPhase').innerText = isNight ? moon.icon : "‚òÄÔ∏è"; // Ng√†y hi·ªán m·∫∑t tr·ªùi, ƒë√™m hi·ªán trƒÉng

            // 4. Update Background Canvas (M∆∞a/Sao)
            initCanvasEffect(wCode, isNight);

            // 5. Smart Alert Logic
            generateSmartMessage(data, uvNow, isNight, wInfo.desc);
        }

        // Mapping m√£ th·ªùi ti·∫øt WMO
        function getWeatherInfo(code) {
            const map = {
                0: {desc: "Tr·ªùi quang", icon: "fa-sun"},
                1: {desc: "√çt m√¢y", icon: "fa-cloud-sun"},
                2: {desc: "Nhi·ªÅu m√¢y", icon: "fa-cloud"},
                3: {desc: "√Çm u", icon: "fa-smog"},
                45: {desc: "S∆∞∆°ng m√π", icon: "fa-smog"},
                51: {desc: "M∆∞a nh·ªè", icon: "fa-cloud-rain"},
                61: {desc: "M∆∞a", icon: "fa-cloud-showers-heavy"},
                80: {desc: "M∆∞a r√†o", icon: "fa-cloud-showers-water"},
                95: {desc: "D√¥ng", icon: "fa-bolt"}
            };
            return map[code] || {desc: "Kh√¥ng x√°c ƒë·ªãnh", icon: "fa-cloud"};
        }

        function getMoonPhaseName(date) {
            let year = date.getFullYear();
            let month = date.getMonth() + 1;
            let day = date.getDate();
            if (month < 3) { year--; month += 12; }
            let c = 365.25 * year;
            let e = 30.6 * month;
            let jd = c + e + day - 694039.09;
            jd /= 29.5305882;
            let b = parseInt(jd);
            jd -= b;
            let phase = Math.round(jd * 8);
            if (phase >= 8) phase = 0;
            const moons = [
                {n: "TrƒÉng M·ªõi", icon: "üåë"}, {n: "L∆∞·ª°i Li·ªÅm", icon: "üåí"}, {n: "B√°n Nguy·ªát", icon: "üåì"}, {n: "Khuy·∫øt Tr∆∞∆°ng", icon: "üåî"},
                {n: "TrƒÉng Tr√≤n", icon: "üåï"}, {n: "Khuy·∫øt V·ªçng", icon: "üåñ"}, {n: "B√°n Nguy·ªát", icon: "üåó"}, {n: "TrƒÉng T√†n", icon: "üåò"}
            ];
            return moons[phase];
        }

        function generateSmartMessage(data, uv, isNight, weatherDesc) {
            const hour = new Date().getHours();
            // Check m∆∞a trong 3h t·ªõi
            const nextRainProb = data.hourly.precipitation_probability.slice(hour, hour+3);
            const willRain = nextRainProb.some(p => p > 60);

            let msg = `Ch√∫c B·∫£o Hy m·ªôt ng√†y t·ªët l√†nh!`;
            let icon = "fa-smile-wink";

            if (willRain) {
                msg = "B·∫£o Hy ∆°i, s·∫Øp c√≥ m∆∞a r·ªìi ƒë√≥ (trong 1-3h t·ªõi). Em nh·ªõ mang √¥ ho·∫∑c √°o m∆∞a nha!";
                icon = "fa-umbrella";
            } else if (uv >= 7 && !isNight) {
                msg = `N·∫Øng ƒëang g·∫Øt l·∫Øm (UV: ${uv}). B·∫£o Hy nh·ªõ b√¥i kem ch·ªëng n·∫Øng v√† che ch·∫Øn k·ªπ nha em.`;
                icon = "fa-sun";
            } else if (isNight) {
                if (hour >= 23) {
                    msg = "Khuya r·ªìi, B·∫£o Hy ng·ªß s·ªõm ƒëi ƒë·ªÉ gi·ªØ g√¨n s·ª©c kh·ªèe nha. Good night!";
                    icon = "fa-bed";
                } else {
                    msg = `Ngo√†i tr·ªùi ƒëang ${weatherDesc.toLowerCase()}. B·∫£o Hy ngh·ªâ ng∆°i th∆∞ gi√£n nh√©.`;
                    icon = "fa-moon";
                }
            }

            updateAlert(msg, icon);
        }

        function updateAlert(text, iconClass) {
            document.getElementById('alertText').innerText = text;
            document.querySelector('.smart-alert i').className = `fas ${iconClass}`;
        }

        // --- 3. NEWS SYSTEM (RSS) ---
        async function fetchNews() {
            // D√πng proxy ƒë·ªÉ l·∫•y RSS VnExpress
            const rssUrl = 'https://vnexpress.net/rss/tin-moi-nhat.rss';
            const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
            
            try {
                const res = await fetch(apiUrl);
                const data = await res.json();
                const items = data.items.slice(0, 10);
                
                const container = document.getElementById('newsContainer');
                container.innerHTML = "";
                
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'news-item';
                    div.onclick = () => window.open(item.link);
                    const time = new Date(item.pubDate).toLocaleTimeString('vi-VN', {hour:'2-digit', minute:'2-digit'});
                    div.innerHTML = `<span class="news-time">${time}</span><span class="news-headline">${item.title}</span>`;
                    container.appendChild(div);
                });
            } catch (e) {
                document.getElementById('newsContainer').innerHTML = "<div class='news-item'>Kh√¥ng t·∫£i ƒë∆∞·ª£c tin t·ª©c.</div>";
            }
        }

        function toggleNews() {
            const panel = document.getElementById('newsPanel');
            if (panel.style.opacity === '0') {
                panel.style.opacity = '1';
            } else {
                panel.style.opacity = '0';
            }
        }

        // --- 4. WIDGETS LOGIC ---
        
        // Pomodoro
        let pomoInterval;
        let pomoTime = 25 * 60;
        let isRunning = false;

        function togglePomodoro() {
            const btn = document.getElementById('pomoBtn');
            if (!isRunning) {
                isRunning = true;
                btn.innerText = "T·∫°m d·ª´ng";
                btn.style.background = "#ff6b6b"; // ƒê·ªè nh·∫°t
                pomoInterval = setInterval(() => {
                    pomoTime--;
                    updatePomoDisplay();
                    if (pomoTime <= 0) {
                        clearInterval(pomoInterval);
                        alert("H·∫øt gi·ªù l√†m vi·ªác r·ªìi B·∫£o Hy ∆°i! Ngh·ªâ ng∆°i x√≠u nha.");
                        resetPomodoro();
                    }
                }, 1000);
            } else {
                clearInterval(pomoInterval);
                isRunning = false;
                btn.innerText = "Ti·∫øp t·ª•c";
                btn.style.background = "var(--sky-blue)";
            }
        }

        function resetPomodoro() {
            clearInterval(pomoInterval);
            isRunning = false;
            pomoTime = 25 * 60;
            updatePomoDisplay();
            document.getElementById('pomoBtn').innerText = "B·∫Øt ƒë·∫ßu";
            document.getElementById('pomoBtn').style.background = "var(--sky-blue)";
        }

        function updatePomoDisplay() {
            const m = Math.floor(pomoTime / 60).toString().padStart(2, '0');
            const s = (pomoTime % 60).toString().padStart(2, '0');
            document.getElementById('pomoTimer').innerText = `${m}:${s}`;
        }

        // Note (LocalStorage)
        const noteArea = document.getElementById('quickNote');
        noteArea.value = localStorage.getItem('baohy_note') || "";
        function saveNote() {
            localStorage.setItem('baohy_note', noteArea.value);
        }

        // Fullscreen
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }

        // --- 5. CANVAS ANIMATION (M∆∞a/Sao) ---
        // (ƒê√¢y l√† ph·∫ßn "code n·∫∑ng" ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng ƒë·∫πp)
        
        function initCanvasEffect(weatherCode, isNight) {
            const canvas = document.getElementById('weather-canvas');
            const ctx = canvas.getContext('2d');
            let w, h, particles = [];
            
            function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
            resize();
            window.addEventListener('resize', resize);
            
            // X√≥a c≈©
            ctx.clearRect(0,0,w,h);
            
            // N·∫øu m∆∞a: t·∫°o h·∫°t m∆∞a
            if (weatherCode >= 50 && weatherCode <= 65) {
                createRain(200); // 200 h·∫°t m∆∞a
            } else if (isNight && weatherCode < 50) {
                createStars(150); // 150 ng√¥i sao
            }
            
            function createRain(count) {
                for(let i=0; i<count; i++) {
                    particles.push({x: Math.random()*w, y: Math.random()*h, speed: Math.random()*10+5, len: Math.random()*20+10});
                }
                function drawRain() {
                    ctx.clearRect(0,0,w,h);
                    ctx.strokeStyle = "rgba(174, 194, 224, 0.5)";
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    for(let p of particles) {
                        ctx.moveTo(p.x, p.y);
                        ctx.lineTo(p.x, p.y + p.len);
                        p.y += p.speed;
                        if (p.y > h) { p.y = -p.len; p.x = Math.random() * w; }
                    }
                    ctx.stroke();
                    requestAnimationFrame(drawRain);
                }
                drawRain();
            }

            function createStars(count) {
                for(let i=0; i<count; i++) {
                    particles.push({x: Math.random()*w, y: Math.random()*h, size: Math.random()*2, alpha: Math.random()});
                }
                function drawStars() {
                    ctx.clearRect(0,0,w,h);
                    ctx.fillStyle = "white";
                    for(let p of particles) {
                        ctx.globalAlpha = p.alpha;
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                        ctx.fill();
                        // Sao l·∫•p l√°nh
                        p.alpha += (Math.random()-0.5)*0.05;
                        if(p.alpha<0) p.alpha=0; if(p.alpha>1) p.alpha=1;
                    }
                    requestAnimationFrame(drawStars);
                }
                drawStars();
            }
        }

        // --- INIT ---
        getAdvancedWeather();
        fetchNews();
        setInterval(getAdvancedWeather, 30 * 60 * 1000); // 30 ph√∫t update th·ªùi ti·∫øt 1 l·∫ßn
        setInterval(fetchNews, 30 * 60 * 1000); // 30 ph√∫t update tin t·ª©c

    </script>
</body>
</html>
