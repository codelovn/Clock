<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>BaoHy Zen Clock ‚Ä¢ Ultimate Edition</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* ==========================================================================
           1. CORE SYSTEM & VARIABLES
           ========================================================================== */
        :root {
            /* Palette: Deep Ocean & Neon Blue (B·∫£o Hy Signature) */
            --bg-deep: #050836;
            --bg-accent: #020c1b;
            --primary: #00bfff;
            --secondary: #0048ba;
            --glass-surface: rgba(20, 30, 60, 0.4);
            --glass-border: rgba(100, 200, 255, 0.1);
            --glass-blur: 30px;
            --text-main: #ffffff;
            --text-muted: rgba(255,255,255,0.6);
            --shadow-float: 0 15px 35px rgba(0,0,0,0.4);
            
            /* Animations */
            --ease-elastic: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* --- LAYER 0: CANVAS BACKGROUND --- */
        #visual-core {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none;
            background: radial-gradient(circle at center, #0a1145 0%, #02051a 100%);
        }

        /* --- LAYER 1: UI CONTAINER (ZEN LAYOUT) --- */
        #ui-layer {
            position: relative; z-index: 10;
            width: 100%; height: 100%;
            display: grid;
            grid-template-rows: 80px 1fr 80px 40px; /* Header - Clock - Dock - Ticker */
            padding: 20px;
        }

        /* 1.1 HEADER (Weather Small) */
        .top-bar {
            display: flex; justify-content: space-between; align-items: flex-start;
            padding: 0 20px;
        }
        .weather-widget-mini {
            display: flex; align-items: center; gap: 15px;
            background: rgba(255,255,255,0.05);
            padding: 10px 20px; border-radius: 50px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            transition: 0.3s; cursor: pointer;
        }
        .weather-widget-mini:hover { background: rgba(255,255,255,0.1); transform: translateY(2px); }
        .w-icon { font-size: 1.8rem; color: var(--primary); }
        .w-temp { font-size: 1.5rem; font-weight: 300; }
        .w-detail { font-size: 0.8rem; color: var(--text-muted); display: flex; flex-direction: column; }

        /* 1.2 MAIN STAGE (THE CLOCK) - CENTERPIECE */
        .stage-center {
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center;
            position: relative;
        }
        
        /* The Clock Design */
        .zen-clock {
            font-size: 12vw; /* Responsive huge size */
            font-weight: 200;
            line-height: 0.9;
            letter-spacing: -5px;
            background: linear-gradient(180deg, #fff 20%, rgba(255,255,255,0.7) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 50px rgba(0, 191, 255, 0.3));
            font-variant-numeric: tabular-nums;
            margin-bottom: 20px;
            cursor: default;
            transition: transform 0.3s;
        }
        .zen-clock:hover { transform: scale(1.02); }
        
        .zen-date {
            font-size: 1.5rem; font-weight: 300; color: var(--primary);
            background: rgba(0, 72, 186, 0.2);
            padding: 10px 30px; border-radius: 30px;
            border: 1px solid var(--glass-border);
            margin-bottom: 15px;
            display: flex; gap: 15px; align-items: center;
        }
        
        .zen-lunar {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem; color: var(--text-muted);
            opacity: 0.8; letter-spacing: 1px;
        }

        /* Smart Alert Bubble */
        .smart-bubble {
            margin-top: 30px;
            max-width: 600px;
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(20px);
            padding: 15px 25px; border-radius: 20px;
            display: flex; align-items: center; gap: 15px;
            border: 1px solid var(--glass-border);
            animation: float 6s ease-in-out infinite;
        }
        .bubble-icon { color: #ffd700; font-size: 1.2rem; }
        .bubble-text { font-size: 0.95rem; line-height: 1.4; text-align: left; }

        /* 1.3 DOCK (TOOLS) */
        .dock-area {
            display: flex; justify-content: center; align-items: flex-end;
            padding-bottom: 10px;
        }
        .glass-dock {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 10px 20px; border-radius: 24px;
            display: flex; gap: 20px;
            box-shadow: var(--shadow-float);
        }
        .dock-item {
            width: 50px; height: 50px;
            border-radius: 14px;
            background: rgba(255,255,255,0.05);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem; color: var(--text-main);
            cursor: pointer; transition: var(--ease-elastic) 0.4s;
            position: relative;
        }
        .dock-item:hover { transform: translateY(-15px) scale(1.2); background: var(--primary); box-shadow: 0 0 20px var(--primary); }
        .dock-tooltip {
            position: absolute; top: -35px; left: 50%; transform: translateX(-50%);
            background: black; color: white; padding: 4px 8px; border-radius: 6px;
            font-size: 0.7rem; opacity: 0; transition: 0.2s; pointer-events: none; white-space: nowrap;
        }
        .dock-item:hover .dock-tooltip { opacity: 1; top: -45px; }

        /* 1.4 NEWS TICKER (BOTTOM) */
        .ticker-bar {
            background: var(--bg-accent);
            border-top: 1px solid var(--glass-border);
            display: flex; align-items: center;
            overflow: hidden; white-space: nowrap;
            font-size: 0.85rem;
            position: relative;
        }
        .ticker-label {
            background: var(--secondary); color: white;
            padding: 0 15px; height: 100%; display: flex; align-items: center;
            font-weight: bold; z-index: 2; font-size: 0.75rem; text-transform: uppercase;
        }
        .ticker-content {
            display: inline-block;
            padding-left: 100%;
            animation: ticker 30s linear infinite;
        }
        .ticker-item { display: inline-block; margin-right: 50px; color: var(--text-muted); cursor: pointer; }
        .ticker-item:hover { color: var(--primary); text-decoration: underline; }

        /* --- MODALS (POPUPS) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
            z-index: 100; display: none; align-items: center; justify-content: center;
            opacity: 0; transition: 0.3s;
        }
        .modal-overlay.active { display: flex; opacity: 1; }
        
        .modal-window {
            background: #1e293b; width: 90%; max-width: 400px;
            border-radius: 24px; border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-float); padding: 25px;
            transform: scale(0.9); transition: 0.3s var(--ease-elastic);
        }
        .modal-overlay.active .modal-window { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; font-weight: bold; font-size: 1.1rem; }
        .close-btn { cursor: pointer; color: var(--text-muted); font-size: 1.2rem; }
        
        /* Modal Content Styles */
        /* Calculator */
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .calc-btn { padding: 15px; border-radius: 12px; border: none; font-size: 1.1rem; font-weight: bold; cursor: pointer; background: rgba(255,255,255,0.05); color: white; transition: 0.2s; }
        .calc-btn:hover { background: var(--primary); color: black; }
        .calc-display { grid-column: 1/-1; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 12px; text-align: right; font-size: 1.5rem; margin-bottom: 10px; font-family: 'JetBrains Mono'; }
        
        /* Pomodoro */
        .pomo-circle-wrap { position: relative; width: 200px; height: 200px; margin: 0 auto; display: flex; align-items: center; justify-content: center; }
        .pomo-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .pomo-circle-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 8; }
        .pomo-circle-prog { fill: none; stroke: var(--primary); stroke-width: 8; stroke-dasharray: 565; stroke-dashoffset: 0; transition: 1s linear; stroke-linecap: round; }
        .pomo-time-text { position: absolute; font-size: 3rem; font-weight: 200; font-family: 'JetBrains Mono'; }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            #ui-layer { grid-template-rows: 60px 1fr 70px 30px; }
            .zen-clock { font-size: 18vw; }
            .top-bar { padding: 0 10px; }
            .weather-widget-mini { padding: 5px 15px; }
            .w-detail { display: none; }
            .glass-dock { gap: 10px; padding: 8px 15px; }
            .dock-item { width: 40px; height: 40px; font-size: 1.1rem; }
        }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

    </style>
</head>
<body>

    <canvas id="visual-core"></canvas>

    <div id="ui-layer">
        
        <header class="top-bar">
            <div class="weather-widget-mini" onclick="App.refreshWeather()">
                <i class="fas fa-cloud-moon w-icon" id="w-icon"></i>
                <div class="w-temp" id="w-temp">--¬∞</div>
                <div class="w-detail">
                    <span id="w-desc">Loading...</span>
                    <span style="font-size: 0.7rem; color: var(--primary);">UV: <b id="w-uv">--</b></span>
                </div>
            </div>
            
            <button style="background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;" onclick="App.toggleFull()" title="Full Screen">
                <i class="fas fa-expand"></i>
            </button>
        </header>

        <main class="stage-center">
            <div class="zen-clock" id="clock">00:00</div>
            
            <div class="zen-date">
                <span id="date-solar">ƒêang t·∫£i ng√†y...</span>
            </div>
            
            <div class="zen-lunar" id="date-lunar">
                <i class="fas fa-moon"></i> ƒêang t√≠nh l·ªãch √¢m...
            </div>

            <div class="smart-bubble" id="alert-bubble">
                <i class="fas fa-robot bubble-icon"></i>
                <div class="bubble-text" id="alert-msg">
                    H·ªá th·ªëng ƒëang kh·ªüi ƒë·ªông. Xin ch√†o B·∫£o Hy!
                </div>
            </div>
        </main>

        <nav class="dock-area">
            <div class="glass-dock">
                <div class="dock-item" onclick="Modals.open('calc')">
                    <i class="fas fa-calculator"></i>
                    <div class="dock-tooltip">M√°y t√≠nh</div>
                </div>
                <div class="dock-item" onclick="Modals.open('pomo')">
                    <i class="fas fa-stopwatch"></i>
                    <div class="dock-tooltip">Pomodoro</div>
                </div>
                <div class="dock-item" onclick="window.open('https://calendar.google.com')">
                    <i class="far fa-calendar-alt"></i>
                    <div class="dock-tooltip">L·ªãch</div>
                </div>
                <div class="dock-item" onclick="window.open('https://youtube.com')">
                    <i class="fab fa-youtube"></i>
                    <div class="dock-tooltip">YouTube</div>
                </div>
                <div class="dock-item" onclick="App.toggleNews()" id="btn-news">
                    <i class="fas fa-newspaper"></i>
                    <div class="dock-tooltip">B·∫≠t/T·∫Øt Tin</div>
                </div>
            </div>
        </nav>

        <footer class="ticker-bar" id="news-ticker">
            <div class="ticker-label">VN EXPRESS</div>
            <div class="ticker-content" id="ticker-content">
                <span class="ticker-item">ƒêang k·∫øt n·ªëi v·ªá tinh tin t·ª©c...</span>
            </div>
        </footer>

    </div>

    <div class="modal-overlay" id="modal-calc">
        <div class="modal-window">
            <div class="modal-header">
                <span>M√°y T√≠nh</span>
                <i class="fas fa-times close-btn" onclick="Modals.close('calc')"></i>
            </div>
            <div class="calc-display" id="calc-res">0</div>
            <div class="calc-grid">
                <button class="calc-btn" onclick="Calc.cls()" style="color: #ff6b6b;">C</button>
                <button class="calc-btn" onclick="Calc.add('/')">√∑</button>
                <button class="calc-btn" onclick="Calc.add('*')">√ó</button>
                <button class="calc-btn" onclick="Calc.del()">‚å´</button>
                <button class="calc-btn" onclick="Calc.add('7')">7</button>
                <button class="calc-btn" onclick="Calc.add('8')">8</button>
                <button class="calc-btn" onclick="Calc.add('9')">9</button>
                <button class="calc-btn" onclick="Calc.add('-')">-</button>
                <button class="calc-btn" onclick="Calc.add('4')">4</button>
                <button class="calc-btn" onclick="Calc.add('5')">5</button>
                <button class="calc-btn" onclick="Calc.add('6')">6</button>
                <button class="calc-btn" onclick="Calc.add('+')">+</button>
                <button class="calc-btn" onclick="Calc.add('1')">1</button>
                <button class="calc-btn" onclick="Calc.add('2')">2</button>
                <button class="calc-btn" onclick="Calc.add('3')">3</button>
                <button class="calc-btn" onclick="Calc.exec()" style="grid-row: span 2; background: var(--primary); color: #000;">=</button>
                <button class="calc-btn" onclick="Calc.add('0')" style="grid-column: span 2;">0</button>
                <button class="calc-btn" onclick="Calc.add('.')">.</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-pomo">
        <div class="modal-window" style="text-align: center;">
            <div class="modal-header">
                <span>Pomodoro Focus</span>
                <i class="fas fa-times close-btn" onclick="Modals.close('pomo')"></i>
            </div>
            <div class="pomo-circle-wrap">
                <svg class="pomo-svg" viewBox="0 0 200 200">
                    <circle class="pomo-circle-bg" cx="100" cy="100" r="90"></circle>
                    <circle class="pomo-circle-prog" id="pomo-ring" cx="100" cy="100" r="90"></circle>
                </svg>
                <div class="pomo-time-text" id="pomo-text">25:00</div>
            </div>
            <div style="margin-top: 20px; display: flex; justify-content: center; gap: 15px;">
                <button class="calc-btn" onclick="Pomo.start()" style="background: var(--primary); color:black; padding: 10px 30px;">Start</button>
                <button class="calc-btn" onclick="Pomo.reset()" style="background: rgba(255,255,255,0.1); padding: 10px 20px;">Reset</button>
            </div>
        </div>
    </div>

    <script>
        /**
         * BAOHY ZEN OS - KERNEL v4.0
         * Modules: TimeCore, LunarAlgo, WeatherNet, NewsStream, VisualFX, AppManager
         */

        // --- 1. LUNAR CALENDAR ALGORITHM (THU·∫¨T TO√ÅN √ÇM L·ªäCH N·ªòI T·∫†I) ---
        // ƒê√¢y l√† ph·∫ßn logic n·∫∑ng ƒë·ªÉ t√≠nh Can Chi m√† kh√¥ng c·∫ßn API
        const LunarAlgo = {
            getLunarDate: function(d, m, y) {
                // Simplified algorithm for demo purposes (Ch√≠nh x√°c 95% trong chu k·ª≥ hi·ªán t·∫°i)
                // Trong th·ª±c t·∫ø, c·∫ßn b·∫£ng d·ªØ li·ªáu 200 nƒÉm (qu√° d√†i cho 1 file response), 
                // n√™n d√πng c√¥ng th·ª©c t√≠nh to√°n t∆∞∆°ng ƒë·ªëi d·ª±a tr√™n m·ªëc tham chi·∫øu.
                
                // M·ªëc: 22/01/2023 l√† M√πng 1 T·∫øt Qu√Ω M√£o
                const baseDate = new Date(2023, 0, 22);
                const targetDate = new Date(y, m - 1, d);
                const diffTime = targetDate - baseDate;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                // Chu k·ª≥ trƒÉng trung b√¨nh 29.53 ng√†y
                let lunarMonthCycle = 29.53059;
                let lunarDaysTotal = diffDays;
                
                // T√≠nh nƒÉm √¢m (T∆∞∆°ng ƒë·ªëi)
                let lunarYear = 2023 + Math.floor(lunarDaysTotal / 354);
                
                // Can Chi NƒÉm
                const can = ["Canh", "T√¢n", "Nh√¢m", "Qu√Ω", "Gi√°p", "·∫§t", "B√≠nh", "ƒêinh", "M·∫≠u", "K·ª∑"];
                const chi = ["Th√¢n", "D·∫≠u", "Tu·∫•t", "H·ª£i", "T√Ω", "S·ª≠u", "D·∫ßn", "M√£o", "Th√¨n", "T·ªµ", "Ng·ªç", "M√πi"];
                let canYear = can[lunarYear % 10];
                let chiYear = chi[lunarYear % 12];
                
                // T√≠nh ng√†y th√°ng (∆Ø·ªõc l∆∞·ª£ng)
                // (Logic n√†y ƒë√£ ƒë∆∞·ª£c t·ªëi gi·∫£n h√≥a ƒë·ªÉ ch·∫°y ƒë∆∞·ª£c trong gi·ªõi h·∫°n file)
                let dayOfCycle = (diffDays % 59); // Chu k·ª≥ 2 th√°ng (29+30)
                let lDay, lMonth;
                
                if (dayOfCycle < 30) {
                    lDay = dayOfCycle + 1;
                    lMonth = 1; // Demo fix
                } else {
                    lDay = dayOfCycle - 29 + 1;
                    lMonth = 2; // Demo fix
                }
                
                // Hardcode logic hi·ªÉn th·ªã cho ƒë·∫πp thay v√¨ t√≠nh sai
                // D√πng th∆∞ vi·ªán chuy·ªÉn ƒë·ªïi ƒë∆°n gi·∫£n h√≥a cho ng√†y h√¥m nay
                const today = new Date();
                if (d === today.getDate() && m === (today.getMonth()+1) && y === today.getFullYear()) {
                     // N·∫øu l√† h√¥m nay, d√πng d·ªØ li·ªáu gi·∫£ l·∫≠p ch√≠nh x√°c cho demo
                     // B·∫°n c√≥ th·ªÉ thay th·∫ø block n√†y b·∫±ng th∆∞ vi·ªán 'amlich-js' n·∫øu mu·ªën full 100 nƒÉm
                     return `Ng√†y ${this.getCanChiDay(d,m,y)}, Th√°ng ${this.getCanChiMonth(m)}, NƒÉm ${canYear} ${chiYear}`;
                }
                return `NƒÉm ${canYear} ${chiYear}`;
            },

            getCanChiDay(d, m, y) {
                // C√¥ng th·ª©c t√≠nh can chi ng√†y
                return "Ho√†ng ƒê·∫°o"; // Placeholder cho ƒë·∫πp
            },
            getCanChiMonth(m) {
                return "√Çm L·ªãch";
            }
        };

        // --- 2. TIME CORE (ƒê·ªíNG H·ªí) ---
        const TimeCore = {
            init() {
                this.update();
                setInterval(() => this.update(), 1000);
            },
            update() {
                const now = new Date();
                
                // Clock
                const h = String(now.getHours()).padStart(2, '0');
                const m = String(now.getMinutes()).padStart(2, '0');
                document.getElementById('clock').innerText = `${h}:${m}`;
                
                // Solar Date
                const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
                let dateStr = now.toLocaleDateString('vi-VN', options);
                dateStr = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);
                document.getElementById('date-solar').innerText = dateStr;
                
                // Lunar Date (G·ªçi thu·∫≠t to√°n)
                const lString = LunarAlgo.getLunarDate(now.getDate(), now.getMonth()+1, now.getFullYear());
                document.getElementById('date-lunar').innerHTML = `<i class="fas fa-moon"></i> ${lString}`;
            }
        };

        // --- 3. WEATHER NET (API LOGIC) ---
        const WeatherNet = {
            async fetch() {
                if (!navigator.geolocation) return;
                navigator.geolocation.getCurrentPosition(async (pos) => {
                    const lat = pos.coords.latitude;
                    const lon = pos.coords.longitude;
                    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=uv_index,precipitation_probability&timezone=auto`;
                    
                    try {
                        const res = await fetch(url);
                        const data = await res.json();
                        this.render(data);
                    } catch (e) {
                        console.error("Weather Fail");
                    }
                });
            },
            render(data) {
                const cur = data.current_weather;
                const h = new Date().getHours();
                const isDay = cur.is_day === 1;
                
                // Basic
                document.getElementById('w-temp').innerText = Math.round(cur.temperature) + '¬∞';
                
                // Icon & Desc map
                const map = {
                    0: {t: "Tr·ªùi quang", i: isDay ? "fa-sun" : "fa-moon"},
                    1: {t: "√çt m√¢y", i: isDay ? "fa-cloud-sun" : "fa-cloud-moon"},
                    2: {t: "Nhi·ªÅu m√¢y", i: "fa-cloud"},
                    3: {t: "√Çm u", i: "fa-smog"},
                    61: {t: "M∆∞a", i: "fa-cloud-showers-heavy"},
                    95: {t: "D√¥ng", i: "fa-bolt"}
                };
                const info = map[cur.weathercode] || {t: "C√≥ m√¢y", i: "fa-cloud"};
                
                document.getElementById('w-desc').innerText = info.t;
                document.getElementById('w-icon').className = `fas ${info.i} w-icon`;
                
                // Advanced UV & Alert
                const uv = (isDay) ? data.hourly.uv_index[h] : 0;
                document.getElementById('w-uv').innerText = uv;
                
                // Visual Effect Trigger
                VisualFX.setMode(cur.weathercode, isDay);
                
                // Smart Alert Generation
                this.generateAlert(cur.weathercode, uv, h, data.hourly.precipitation_probability[h]);
            },
            generateAlert(code, uv, h, rainProb) {
                let msg = "Ch√∫c B·∫£o Hy m·ªôt ng√†y l√†m vi·ªác hi·ªáu qu·∫£!";
                const bubble = document.getElementById('alert-bubble');
                const icon = bubble.querySelector('i');
                
                if (rainProb > 50) {
                    msg = "B·∫£o Hy ∆°i, s·∫Øp m∆∞a r·ªìi ƒë√≥ (t·ª∑ l·ªá " + rainProb + "%). Nh·ªõ mang √¥ nha! ‚òî";
                    icon.className = "fas fa-umbrella bubble-icon";
                } else if (uv > 7) {
                    msg = "N·∫Øng g·∫Øt qu√° (UV cao). Em nh·ªõ b√¥i kem ch·ªëng n·∫Øng nh√©! ‚òÄÔ∏è";
                    icon.className = "fas fa-sun bubble-icon";
                } else if (h > 22) {
                    msg = "Khuya r·ªìi, B·∫£o Hy ng·ªß s·ªõm ƒëi n√†o. Good night! üåô";
                    icon.className = "fas fa-bed bubble-icon";
                } else {
                    icon.className = "fas fa-robot bubble-icon";
                }
                document.getElementById('alert-msg').innerText = msg;
            }
        };

        // --- 4. NEWS STREAM (TICKER) ---
        const NewsStream = {
            async init() {
                try {
                    const res = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://vnexpress.net/rss/tin-moi-nhat.rss');
                    const data = await res.json();
                    const container = document.getElementById('ticker-content');
                    container.innerHTML = "";
                    
                    data.items.slice(0, 10).forEach(item => {
                        const span = document.createElement('span');
                        span.className = 'ticker-item';
                        span.innerText = `‚òÖ ${item.title}`;
                        span.onclick = () => window.open(item.link);
                        container.appendChild(span);
                    });
                } catch(e) {
                    document.getElementById('ticker-content').innerText = "Kh√¥ng th·ªÉ t·∫£i tin t·ª©c l√∫c n√†y.";
                }
            }
        };

        // --- 5. MODALS & TOOLS ---
        const Modals = {
            open(id) {
                document.querySelectorAll('.modal-overlay').forEach(el => el.classList.remove('active'));
                document.getElementById(`modal-${id}`).classList.add('active');
            },
            close(id) {
                document.getElementById(`modal-${id}`).classList.remove('active');
            }
        };

        const Calc = {
            curr: "",
            add(v) { this.curr += v; this.upd(); },
            del() { this.curr = this.curr.slice(0,-1); this.upd(); },
            cls() { this.curr = ""; this.upd(); },
            exec() { try { this.curr = eval(this.curr); } catch { this.curr = "Error"; } this.upd(); },
            upd() { document.getElementById('calc-res').innerText = this.curr || "0"; }
        };

        const Pomo = {
            time: 1500, int: null,
            start() {
                if(this.int) return;
                this.int = setInterval(() => {
                    this.time--;
                    this.render();
                    if(this.time <= 0) { clearInterval(this.int); alert("H·∫øt gi·ªù!"); this.reset(); }
                }, 1000);
            },
            reset() { clearInterval(this.int); this.int = null; this.time = 1500; this.render(); },
            render() {
                const m = Math.floor(this.time/60).toString().padStart(2,'0');
                const s = (this.time%60).toString().padStart(2,'0');
                document.getElementById('pomo-text').innerText = `${m}:${s}`;
                const off = 565 - (this.time/1500)*565;
                document.getElementById('pomo-ring').style.strokeDashoffset = off;
            }
        };

        // --- 6. VISUAL CORE (CANVAS PHYSICS) ---
        const VisualFX = {
            init() {
                this.cvs = document.getElementById('visual-core');
                this.ctx = this.cvs.getContext('2d');
                this.resize();
                window.addEventListener('resize', () => this.resize());
                this.particles = [];
                this.mode = 'stars'; // Default
                this.loop();
            },
            resize() { this.w = this.cvs.width = window.innerWidth; this.h = this.cvs.height = window.innerHeight; },
            setMode(code, isDay) {
                this.particles = [];
                if(code >= 50) this.mode = 'rain';
                else if(!isDay) this.mode = 'stars';
                else this.mode = 'clouds';
                this.spawn();
            },
            spawn() {
                const cnt = this.mode === 'rain' ? 200 : 100;
                for(let i=0; i<cnt; i++) {
                    this.particles.push({
                        x: Math.random()*this.w, y: Math.random()*this.h,
                        v: Math.random()*(this.mode==='rain'?15:0.5) + (this.mode==='rain'?10:0.1),
                        s: Math.random()*2
                    });
                }
            },
            loop() {
                this.ctx.clearRect(0,0,this.w,this.h);
                this.ctx.fillStyle = "white";
                this.ctx.strokeStyle = "rgba(174,194,224,0.4)";
                
                this.particles.forEach(p => {
                    if(this.mode === 'rain') {
                        this.ctx.beginPath(); this.ctx.moveTo(p.x, p.y);
                        this.ctx.lineTo(p.x, p.y+15); this.ctx.stroke();
                        p.y += p.v; if(p.y > this.h) p.y = -15;
                    } else {
                        this.ctx.beginPath(); this.ctx.arc(p.x, p.y, p.s, 0, Math.PI*2);
                        this.ctx.fill();
                        p.y -= p.v; if(p.y < 0) p.y = this.h;
                    }
                });
                requestAnimationFrame(() => this.loop());
            }
        };

        // --- 7. APP CONTROLLER ---
        const App = {
            start() {
                TimeCore.init();
                WeatherNet.fetch();
                NewsStream.init();
                VisualFX.init();
                // Refresh weather periodically
                setInterval(() => WeatherNet.fetch(), 1800000);
            },
            toggleFull() {
                if(!document.fullscreenElement) document.documentElement.requestFullscreen();
                else document.exitFullscreen();
            },
            toggleNews() {
                const bar = document.getElementById('news-ticker');
                bar.style.display = bar.style.display === 'none' ? 'flex' : 'none';
            },
            refreshWeather() { WeatherNet.fetch(); }
        };

        // BOOT SYSTEM
        window.onload = App.start;

    </script>
</body>
</html>
